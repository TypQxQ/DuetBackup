# SET_VELOCITY_LIMIT [VELOCITY=<value>] [ACCEL=<value>] [ACCEL_TO_DECEL=<value>] [SQUARE_CORNER_VELOCITY=<value>]

[gcode_macro M204]
rename_existing: M204.1
gcode:
  {% if params.S is defined %}
    {% set s = params.S|float %}
  {% elif params.P is defined or params.T is defined %}
    {% set p = params.P|default(999999)|int %}
    {% set t = params.T|default(999999)|int %}
    {% if p < t %}
      {% set s = p %}
    {% else %}
      {% set s = t %}
    {% endif %}
  {% else %}
    { action_raise_error("M204: Must define S, P or T parameter.") }
  {% endif %}

  SET_VELOCITY_LIMIT ACCEL={s} ACCEL_TO_DECEL={s*0.5}
