# This command can NOT be used without any additional parameters.
# Pnnn Tool number
# Hnnn Heater number. 0="heater_bed", 1="extruder", 2="extruder1", etc.
# Snn Tolerance in degC. Defaults to 2*C

[gcode_macro M116]
gcode:
  {% set p = params.P %}
  {% set s = params.H %}

  {% if params.P is defined and params.H is defined  %}
    { action_raise_error("M116: Can't use both P and H parameter.") }
  {% elif params.P is defined  %} # Tool is defined
    {% set heater = printer["gcode_macro T"~params.P|string].extruder %}  # heater to extruder of tool.
  {% elif params.H is defined  %} # Heater is defined
    {% set h = params.H|int %}
    {% if h == 0  %} # Heater is defined
      {% set heater = "heater_bed" %}
    {% else %}
      {% set h = h-1 %}
      {% if h == 0  %} # Heater is valid for a tool
        {% set heater = "extruder" %}
      {% elif h > 0  %} # Heater is valid for a tool
        {% set heater = "extruder"~h %}
      {% else %} # Not a valid h
        { action_raise_error("M116: Invalid H parameter.") }
      {% endif %} # /Heater is valid for a tool
    {% endif %} # /Heater is defined
  {% else %} # Wait for both 
    { action_raise_error("M116: Must use a P or H parameter.") }
  {% endif %}

  M117 {heater}

  

[gcode_macro M116001]
gcode:
#M117 "{printer[h].temperature}"