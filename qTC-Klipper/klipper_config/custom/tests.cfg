[gcode_macro test_speed_fast]
gcode:
        G28 X0 Y0
        M114
        G1 X0 Y0     F60000
        G1 X500 Y500 F60000
        G1 X0 Y0     F60000
        G1 X500 Y500 F60000

        G1 X0 Y500 F60000

        G1 X500 Y0 F60000
        G1 X0 Y500 F60000
        G1 X500 Y0 F60000
        G1 X0 Y500 F60000

        G1 X0 Y0 F60000
        G1 X500 Y0 F60000
        G1 X500 Y500 F60000
        G1 X0 Y500 F60000
        G1 X0 Y0 F60000
        ;G28 X0 Y0
        M114


[gcode_macro GoToProbe]
gcode:
  G90
  G0 x43.9 y63.87 Z173

[gcode_macro TEST]
gcode:
#  {% set tool = printer["gcode_macro T"~printer["gcode_macro T"~printer["gcode_macro LOCK_INIT"].tool_current].ercf_physical_tool]|default(printer["gcode_macro T"~printer["gcode_macro LOCK_INIT"].tool_current]) %}
  {% set tc = printer.toollock.tool_current|int %} # printer.toollock.tool_current
  {% if tc >= 0 %}
    {% set myself = printer['tool '~tc] %}
    { action_respond_info("Current tool Y zone is: "~ myself.zone[1]) }
    {action_respond_info("Current tool is: %i" % (tc)) }
#    G0 X500 Y{myself.zone[1]} F3000                                     # Move XY inside the safezone before restoring position, in case the restore position is moving the tool inside the parking zone.
  {% endif %} 
#  {% set tc = printer['tool '~params.T]%}
# %}
#  {% if tc.extruder is defined %}
#    RESPOND MSG="{printer.lookup_object('ToolLock').tool_current}"
#    RESPOND MSG="Name is:{tc.name}."
#    RESPOND MSG="ID is:{tc.id}."
#    RESPOND MSG="{printer.toollock.tool_current}"
#    {% set tl = printer["ToolLock ToolLock"] %}
#    RESPOND MSG="{printer["ToolLock ToolLock"].temperature}"
#  {% else %}
#    RESPOND MSG="Undefined"
#  {% endif %} 

[gcode_macro TST_TPFD]
gcode:
  M18
  {% set value = params.VALUE|lower %}
  SET_TMC_FIELD STEPPER=stepper_x FIELD=TPFD VALUE={value}
  SET_TMC_FIELD STEPPER=stepper_x1 FIELD=TPFD VALUE={value}
  SET_TMC_FIELD STEPPER=stepper_y FIELD=TPFD VALUE={value}
  SET_TMC_FIELD STEPPER=stepper_y1 FIELD=TPFD VALUE={value}

[gcode_macro SEARCH_VARS]
gcode:
    {% set search = params.S|lower %}
    {% set ns = namespace() %}
    {% for item in printer  %}
        {% if ' ' in item %}
            {% set ns.path = ['printer', "['%s']" % (item), ''] %}
        {% else %}
            {% set ns.path = ['printer.', item, ''] %}   
        {% endif %} 

        {% if search in ns.path|lower %}
            { action_respond_info(ns.path|join) }
        {% endif %} 

        {% if printer[item].items() %}
            {% for childkey, child in printer[item].items() recursive %}
                {% set ns.path = ns.path[:loop.depth|int + 1] %}

                {% if ' ' in childkey %}
                    {% set null = ns.path.append("['%s']" % (childkey)) %}
                {% else %}
                    {% set null = ns.path.append(".%s" % (childkey)) %}
                {% endif %} 

                {% if child is mapping  %}
                    { loop(child.items()) }
                {% else %}
                    {% if search in ns.path|lower %}
                        { action_respond_info("%s : %s" % (ns.path|join, child)) }   
                    {% endif %} 
                {% endif %} 
                
            {% endfor %}
        {% endif %} 
    {% endfor %}

[gcode_macro SavePosition]
gcode:
  SAVE_POSITION

[gcode_macro RestorePosition]
gcode:
  RESTORE_POSITION

[gcode_macro KTCC_Stats]
gcode:
  KTCC_DUMP_STATS
